<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="KaiChu"><title>weddingcnp via GCP ｜ KaiChu</title><meta name=description content="Cage &amp;amp; Ping wedding 是一個我們為結婚喜宴處理朋友出席報名相關事宜特別開發的網站，所有的服務全部建構在 Google Cloud Platform 上 功能大至如下: 喜宴相關資訊 訂婚場/結婚場時間、地點、交通資訊 出席人數統計(強制使用 Google/Facebook 登入)。訂婚場/結婚"><meta name=keywords content="Hugo,theme,zozo"><link rel="shortcut icon" href=https://kaichu.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://kaichu.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://kaichu.io/css/zozo.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://kaichu.io/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://kaichu.io/><span>KaiChu</span></a></h1></div><div class=description><p class=sub_title>Life is unique by how you shape it</p><div class=my_socials><a href=https://github.com/cage1016 title=github target=_blank><i class=ri-github-fill></i></a><a href=https://www.instagram.com/cage1016/ title=instagram target=_blank><i class=ri-instagram-fill></i></a><a href=https://www.linkedin.com/in/kaichuchung title=linkedin target=_blank><i class=ri-linkedin-fill></i></a><a href=https://www.slideshare.net/cagechung title=slideshow target=_blank><i class=ri-slideshow-fill></i></a><a href=https://twitter.com/CageChung title=twitter target=_blank><i class=ri-twitter-fill></i></a><a href=https://kaichu.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/weddingcnp-via-gcp/>weddingcnp via GCP</a></h2><span class=date>2017.06.08</span></div><div class="post_content markdown"><p><a href=http://weddingcnp.appspot.com/>Cage & Ping wedding</a> 是一個我們為結婚喜宴處理朋友出席報名相關事宜特別開發的網站，所有的服務全部建構在 Google Cloud Platform 上</p><p>功能大至如下:</p><ul><li><p>喜宴相關資訊</p><ul><li>訂婚場/結婚場時間、地點、交通資訊</li><li>出席人數統計(強制使用 Google/Facebook 登入)。訂婚場/結婚場，人數、葷素、兒童椅等，需不需要住宿</li></ul></li><li><p>婚紗搶先看，先公開一部份。喜宴當天再公佈所有照片</p></li><li><p>喜宴進行中的 <a href=http://weddingcnp.appspot.com/bingo>Bingo</a> 遊戲</p></li><li><p>EDM (發佈 email 給參加的朋友)</p></li><li><p>GA (關心一下有多少人來看)</p></li></ul><div class=fancybox><a data-fancybox=gallery href=https://kaichu.io/images/posts/weddingcnp-via-gpc-0_1.png data-caption><img src=https://kaichu.io/images/posts/weddingcnp-via-gpc-0_1.png></a></div><p>因為我們規劃了一些特別的梗(其實是要幫每一個出席的人作一張專屬的桌卡)，所需要每一個人的大頭照(avatar)，立馬就動到使用 Google/Facebook 進行登入，授權後程式能夠自動的抓到每一個人的照片，雖然不是每一個人的照片解析度都夠進行後制的加工，不過已經可以節省下非常多的時間</p><p>有結過婚的朋友都非常的清楚，統計出席人數是一件很麻煩的事情，出席的大人數、小孩數、小孩有沒有佔位、需不需要兒童座椅、有沒有住宿的需求。種種的資料統計很麻煩，所以就計設出一個表單，想出席的朋友直接登入 Google/Facebook 帳號後，填完相關問題的表單送出後就好了，收單前可以俢改資料(這塊踩到大的雷，透過 Google Analytic 可以很多是直接使用手機登入網站，不過遇到表單無法送出的問題，後來針對相容性作調整後才讓大家順利的報完名)</p><h2 id=weddingcnp-architecture>weddingcnp architecture</h2><div class=fancybox><a data-fancybox=gallery href=https://kaichu.io/images/posts/weddingcnp-via-gpc-0_2.png data-caption><img src=https://kaichu.io/images/posts/weddingcnp-via-gpc-0_2.png></a></div><p>上面是 <a href=http://weddingcnp.appspot.com/>weddingcnp</a> 的架構圖，整個網站完全是架構在 Google App Engine 上，透過 <code>dispatch.yaml</code> 的設定將流量切為服務前端靜態網頁(golang + vue.js + auth0)及後端 endpoint API 的部份。前後端為不同的 instance, 可以容易在 Google App Engine 的管理介面中計對前後端別分進行版控</p><p>Enpoints API 作為接收前端送過來的資料，並接報名相關資料儲存到 Google DataStore, 並自動將使用者的 Avatar 儲存到 Google Cloud Storage 並將所有的名單透過 Google client API 轉存一份至 Google Drive 方便後序處理。只要有人報名會自動透過 sendgrid 寄通知到自己的信箱，不需一直去盯著 Google Spreadsheet 上面的名單有沒有增加</p><p>整個構架的實作細節我會分為五個部份來說明, 先把標題寫出來，內容會陸續的補上</p><h4 id=1-weddingcnp-專案架構切分>1. weddingcnp 專案架構切分</h4><p>使用 Google App Engine golang standard runtime 來作為網站的服務器，選擇使用吃資源較少的 golang，機器平均開機後的記憶體大約 200-300 MB, 效能比 Python 的好太多了</p><p>使用 <code>dispatch.yaml</code> 來進行服務的切分，將 endpoint API 的部份導至另外的 instance 作處理</p><h4 id=2-weddingcnp-前端頁面設計實作>2. weddingcnp 前端頁面設計實作</h4><p>前端使用 <code>echo</code> 框架搭配 template 來產出頁面</p><h4 id=3-weddingcnp-endpointapi-設計實作>3. weddingcnp endpointAPI 設計實作</h4><p>利用 <code>dispatch.yaml</code> 來指定 endpoint API 實作的 Service，這邊基本 endpoint API 熟悉度使用 Python 版本，service 的另一個好處是可以再同一個專案下使用混合的語言來發開，這兒的例子是前端使用 golang, endpoint API 的部份使用 Python，搭配 Flexible 的環境也可以的，彈性非常的高</p><h4 id=4-weddingcnp-前端-vuejs-設計實作>4. weddingcnp 前端 vue.js 設計實作</h4><p>本來是打算使用 react.js 來實作前端，不過太花時間了，所以選擇了 vue.js 來快速實作出介接 endpoint API 前端的表單</p><h4 id=5-weddingcnp-edm-寄送-sendgrid>5. weddingcnp edm 寄送 sendgrid</h4><p>在收集到名單時，可以發通知給朋友。這兒的例子是我們的婚紗照片上線時，就發了 EDM 通知告訴朋友快點上來看。使用的是 sendgrid 來發信，透過 sendgrid 的模版、client API 讓發 html 的 EDM 輕鬆多了</p><h4 id=weddingcnp-系例傳送門>weddingcnp 系例傳送門</h4><ol><li><a href=https://kaichu.io/2017/06/08/weddingcnp-via-gcp/>weddingcnp via GCP 簡介</a></li><li><a href=https://kaichu.io/2017/06/12/weddingcnp-via-gcp-1/>weddingcnp via GCP - 1. 專案架構切分</a></li><li><a href=https://kaichu.io/2017/06/18/weddingcnp-via-gcp-2/>weddingcnp via GCP - 2. 前端頁面設計實作</a></li><li><a href=https://kaichu.io/2017/07/12/weddingcnp-via-gcp-3/>weddingcnp via GCP - 3. endpointAPI 設計實作</a></li><li>weddingcnp 前端 vue.js 設計實作</li><li>weddingcnp edm 寄送 sendgrid</li></ol></div><div class=post_footer><div class="post_content markdown"><h3>See Also</h3><ul><li><a href=/posts/gae-go-image-api/>GAE go Image API for GCS</a></li><li><a href=/posts/gae-link-pip-helper/>gae link pip helper</a></li><li><a href=/posts/gae-appcfg-update-403/>gae appcfg update 403</a></li><li><a href=/posts/managed-vms-lab/>Managed VMs lab</a></li><li><a href=/posts/gcsiterator/>GCSIterator (Python CSV iterator for Google Cloud Storage) via GAE</a></li></ul></div><div class=meta><div class=info><span class="field tags"><i class=ri-stack-line></i><a href=https://kaichu.io/tags/gae/>GAE</a>
<a href=https://kaichu.io/tags/gce/>GCE</a>
<a href=https://kaichu.io/tags/datastore/>Datastore</a>
<a href=https://kaichu.io/tags/endpointapi/>EndpointAPI</a>
<a href=https://kaichu.io/tags/sendgrid/>sendgrid</a>
<a href=https://kaichu.io/tags/api/>API</a></span></div></div></div></div><div class=doc_comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"kaichu.io"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>My spiritual home</span></div></footer><script src=https://kaichu.io/js/jquery-3.5.1.min.js></script><link href=https://kaichu.io/css/fancybox.min.css rel=stylesheet><script src=https://kaichu.io/js/fancybox.min.js></script><script src=https://kaichu.io/js/zozo.js></script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[\[','\]\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-65308340-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>