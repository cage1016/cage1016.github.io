<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="KaiChu"><title>CloudFunctions Google maps service ｜ KaiChu</title><meta name=description content="Waldo-gcp Waldo-gcp 在 2015 時 Google I/O Extended Taipei 時分享過一個計算最佳路徑的微服務。在提供幾組 Google Maps 上有效的地址，透過 Google Maps Distance Matrix API 來計算出每一個點一點之間的旅行距離及旅行時間。再透過基因演算出計算出周遊一圈旅行最短路徑
# 提供5組 Google Maps 上有效的地址 台北市內湖區瑞光路227號1樓, 高雄市鼓山區美術東二路106號, 台南市長榮路一段175號, 臺北市松山區南京東路五段123巷1弄15號, 高雄市五福四路131號2樓"><meta name=keywords content="Hugo,theme,zozo"><link rel="shortcut icon" href=https://kaichu.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://kaichu.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://kaichu.io/css/zozo.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://kaichu.io/css/highlight.css></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://kaichu.io/><span>KaiChu</span></a></h1></div><div class=description><p class=sub_title>Life is unique by how you shape it</p><div class=my_socials><a href=https://github.com/cage1016 title=github target=_blank><i class=ri-github-fill></i></a><a href=https://www.instagram.com/cage1016/ title=instagram target=_blank><i class=ri-instagram-fill></i></a><a href=https://www.linkedin.com/in/kaichuchung title=linkedin target=_blank><i class=ri-linkedin-fill></i></a><a href=https://www.slideshare.net/cagechung title=slideshow target=_blank><i class=ri-slideshow-fill></i></a><a href=https://twitter.com/CageChung title=twitter target=_blank><i class=ri-twitter-fill></i></a><a href=https://kaichu.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/cloudfunctions-google-maps-services/>CloudFunctions Google maps service</a></h2><span class=date>2017.08.18</span></div><div class="post_content markdown"><h3 id=waldo-gcp>Waldo-gcp</h3><p><a href=https://www.slideshare.net/cagechung/waldogcp>Waldo-gcp</a> 在 2015 時 Google I/O Extended Taipei 時分享過一個計算最佳路徑的微服務。在提供幾組 Google Maps 上有效的地址，透過 Google Maps Distance Matrix API 來計算出每一個點一點之間的旅行距離及旅行時間。再透過基因演算出計算出周遊一圈旅行最短路徑</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=c1># 提供5組 Google Maps 上有效的地址</span>

台北市內湖區瑞光路227號1樓,
高雄市鼓山區美術東二路106號,
台南市長榮路一段175號,
臺北市松山區南京東路五段123巷1弄15號,
高雄市五福四路131號2樓
</code></pre></div><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=c1># 透過 Google Maps Distance Matrix API 計算出  origin, destination, distance, duration</span>

台北市內湖區瑞光路227號1樓, 高雄市鼓山區美術東二路106號, 352777, <span class=m>13532</span>
台北市內湖區瑞光路227號1樓, 台南市長榮路一段175號, 314041, <span class=m>12166</span>
台北市內湖區瑞光路227號1樓, 臺北市松山區南京東路五段123巷1弄15號, 5167, <span class=m>783</span>
台北市內湖區瑞光路227號1樓, 高雄市五福四路131號2樓, 356215, <span class=m>14018</span>
高雄市鼓山區美術東二路106號, 台南市長榮路一段175號, 46668, <span class=m>3203</span>
高雄市鼓山區美術東二路106號, 臺北市松山區南京東路五段123巷1弄15號, 355397, <span class=m>14131</span>
高雄市鼓山區美術東二路106號, 高雄市五福四路131號2樓, 4166, <span class=m>748</span>
台南市長榮路一段175號, 臺北市松山區南京東路五段123巷1弄15號, 314250, <span class=m>12475</span>
台南市長榮路一段175號, 高雄市五福四路131號2樓, 49930, <span class=m>3339</span>
臺北市松山區南京東路五段123巷1弄15號, 高雄市五福四路131號2樓, 359485, <span class=m>14338</span>
</code></pre></div><div class=fancybox><a data-fancybox=gallery href=https://kaichu.io/images/posts/cloudfunctions-google-maps-services-1.png data-caption><img src=https://kaichu.io/images/posts/cloudfunctions-google-maps-services-1.png></a></div><h3 id=cloudfunctions-google-maps-service>CloudFunctions Google maps service</h3><blockquote><p>Google Cloud Functions is a lightweight compute solution for developers to create single-purpose, stand-alone functions that respond to Cloud events without the need to manage a server or runtime environment - Google Cloud Functions Documentation</p></blockquote><p><a href=https://www.slideshare.net/cagechung/waldogcp>Waldo-gcp</a> 微服務中透過 flex runtime GAE Python 中的 library(googlemaps) 來呼叫 Google Maps Distance Matrix API. Google Function 在這很適合取代原來 Python 版本的 Google Maps Distance Matrix API.</p><p>Cloud functions 可以建立 <code>Background Funtions</code>, <code>HTTP Functions</code> + <code>HTTP Triggers</code>, <code>Cloud Pub/Sub Triggers</code>, <code>Cloud Storage Triggers</code>, <code>Direct Triggers</code>. 所以我們可以建立一個可以執行 Google Maps Distance Matrix API 的 Cloud Functions, 透過起 <code>HTTP Triggers</code>, <code>Direct Triggers</code> 即可以建立計算旅行路徑的距離及時間</p><h2 id=getting-started>Getting Started</h2><p>Github repo: <a href=https://github.com/cage1016/cloudfunctions-google-maps-services>cage1016/cloudfunctions-google-maps-services</a></p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=c1># clone repo</span>
$ git git@github.com:cage1016/cloudfunctions-google-maps-services.git <span class=o>&amp;&amp;</span> <span class=nb>cd</span> cloudfunctions-google-maps-services

<span class=c1># install node packages</span>
$ npm install
</code></pre></div><p>修改 <code>index.js</code> 中 API Key, <code>&lt;YOUR-GCP-API-KEY></code>, 並確保你的 GCP 專案有啟用 Google Maps Distance Matrix API</p><div class=highlight><pre class=chroma><code class=language-js data-lang=js><span class=kr>const</span> <span class=nx>googleMapsClient</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;@google/maps&#39;</span><span class=p>).</span><span class=nx>createClient</span><span class=p>({</span>
    <span class=nx>key</span><span class=o>:</span> <span class=s1>&#39;&lt;YOUR-GCP-API-KEY&gt;&#39;</span>
<span class=p>})</span>

<span class=p>...</span>
</code></pre></div><h3 id=distancematrix-background>distanceMatrix background</h3><blockquote><p>修改 <code>makefile</code> 中 <code>BUCKET=&lt;YOUR-GCS-BUCKET></code> Google Cloud Storage Bucket, Bucket 為 Cloud Functions 上傳的位置</p></blockquote><p>修改完依序執行即可</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=c1># deploy distanceMatrix</span>
$ make deploy_backend

<span class=c1># call distanceMatrix</span>
$ make call_backend

<span class=c1># log distanceMatrix</span>
$ make log_backend

<span class=c1># show description of distanceMatrix function</span>
$ make describe_backend
</code></pre></div><h3 id=distancematrix-background-1>distanceMatrix background</h3><blockquote><p>修改 <code>https://&lt;YOUR_REGION>-&lt;YOUR_PROJECT_ID>.cloudfunctions.net/distanceMatrixHttp</code> endpoint, endpoints 可由 <code>make deploy_http</code> 中得到</p></blockquote><p>修改完依序執行即可</p><div class=highlight><pre class=chroma><code class=language-sh data-lang=sh><span class=c1># deploy distanceMatrixHttp</span>
$ make deploy_http

<span class=c1># call distanceMatrixHttp</span>
$ make call_http

<span class=c1># log distanceMatrixHttp</span>
$ make log_http

<span class=c1># show description of distanceMatrixHttp function</span>
$ make describe_http
</code></pre></div><h3 id=cloudfunctions>CloudFunctions</h3><div class=fancybox><a data-fancybox=gallery href=https://kaichu.io/images/posts/cloudfunctions-google-maps-services-2.png data-caption><img src=https://kaichu.io/images/posts/cloudfunctions-google-maps-services-2.png></a></div><h2 id=reference>Reference</h2><ul><li><a href=https://github.com/googlemaps/google-maps-services-js>googlemaps/google-maps-services-js: Node.js client library for Google Maps API Web Services</a></li><li><a href="https://developers.google.com/maps/documentation/distance-matrix/intro?hl=en">Developer&rsquo;s Guide | Google Maps Distance Matrix API | Google Developers</a></li><li><a href=https://cloud.google.com/functions/docs/>Google Cloud Functions Documentation | Cloud Functions | Google Cloud Platform</a></li></ul></div><div class=post_footer><div class="post_content markdown"><h3>See Also</h3><ul><li><a href=/posts/adc/>Google Announce Application Default Credentials (ADC)</a></li></ul></div><div class=meta><div class=info><span class="field tags"><i class=ri-stack-line></i><a href=https://kaichu.io/tags/cloudfunctions/>cloudfunctions</a>
<a href=https://kaichu.io/tags/googlemaps/>googlemaps</a>
<a href=https://kaichu.io/tags/gcp/>GCP</a></span></div></div></div></div><div class=doc_comments><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"kaichu.io"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span>My spiritual home</span></div></footer><script src=https://kaichu.io/js/jquery-3.5.1.min.js></script><link href=https://kaichu.io/css/fancybox.min.css rel=stylesheet><script src=https://kaichu.io/js/fancybox.min.js></script><script src=https://kaichu.io/js/zozo.js></script><script type=text/javascript async src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$'],['\[\[','\]\]']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});</script><style>code.has-jax{font:inherit;font-size:100%;background:inherit;border:inherit;color:#515151}</style><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-65308340-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></body></html>