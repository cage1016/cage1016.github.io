<!DOCTYPE html><html lang="en"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title>GCSIterator (Python CSV iterator for Google Cloud Storage) via GAE · Kaichu.io</title><meta name="description" content="GCSIterator (Python CSV iterator for Google Cloud Storage) via GAE - KAI CHU CHUNG"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="/css/customize.css"><link rel="search" type="application/opensearchdescription+xml" href="http://kaichu.io/atom.xml" title="Kaichu.io"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://twitter.com/CageChung" target="_blank" class="nav-list-link">TWITTER</a></li><li class="nav-list-item"><a href="https://github.com/cage1016" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="http://www.slideshare.net/cagechung" target="_blank" class="nav-list-link">SLIDESHARE</a></li><li class="nav-list-item"><a href="https://www.linkedin.com/in/kaichuchung" target="_blank" class="nav-list-link">LINKEDIN</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">GCSIterator (Python CSV iterator for Google Cloud Storage) via GAE</h1><div class="post-info">Jul 28, 2015</div><div class="post-content"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p>最近的專案常常需要在 <a href="https://cloud.google.com/appengine/docs/python/" target="_blank" rel="noopener">GAE - Python</a> 跟大 CSV (40MB)檔打交道。在 Python 中利用 <code>csv.reader</code> &amp; <code>csv.DictReader</code><br>可以很容易的處理 <code>csv</code> 讀取的動作。但是在 GAE 平台上一般 Request 時間只有 <strong>60s</strong>，而 Tasks Request 則有 <strong>10mins</strong> 的限制[3]，而在 GAE 上處理超大檔案的時候除了會遇到<br><code>DeadlineExceededErrors</code> 的雷也會踩到 <code>Exceeded soft private memory limit</code> 的問題(預設 instance 的記憶體只有 <strong>128MB</strong>，在處理大 CSV 檔很容易踩到的雷)</p>
<p>所以在處理大 CSV 檔最好不要一次就把所有的資料讀到記憶體中，而 GAE 上又有檔案存取的限制，所以大部份會搭配 <a href="https://cloud.google.com/storage/" target="_blank" rel="noopener">GCS</a> 一起使用，<br>把檔案放在 GCS 上，由 GAE 透過 <code>google-api-python-client</code> 到 GCS 進行檔案的存取</p>
<p><code>google-api-python-client</code> 中實作了 GCS JSON API 的 chunks 下載(<strong>MediaIoBaseDownload</strong> [4])，在 chunks 下載時就必需另外處理斷行的問題(實作 Python csv.DictReader iterator 內解決斷行問題)</p>
<a id="more"></a>
<h2 id="GCSIterator-py"><a href="#GCSIterator-py" class="headerlink" title="GCSIterator.py"></a>GCSIterator.py</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># GCSIterator.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> apiclient.errors <span class="keyword">import</span> HttpError</span><br><span class="line"></span><br><span class="line">DEFAULT_CHUNK_SIZE = <span class="number">512</span> * <span class="number">1024</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GCSIterator</span><span class="params">(object)</span>:</span></span><br><span class="line">  <span class="string">"""</span></span><br><span class="line"><span class="string">  Reference:</span></span><br><span class="line"><span class="string">  Parsing Large CSV Blobs on Google App Engine by Daniel Thompson @ d4nt</span></span><br><span class="line"><span class="string">  http://d4nt.com/parsing-large-csv-blobs-on-google-app-engine</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Implement Google Cloud Storage csv.DictReader Iterator</span></span><br><span class="line"><span class="string">  """</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, request, progress=<span class="number">0</span>, chunksize=DEFAULT_CHUNK_SIZE)</span>:</span></span><br><span class="line">    self._request = request</span><br><span class="line">    self._uri = request.uri</span><br><span class="line">    self._chunksize = chunksize</span><br><span class="line">    self._progress = progress</span><br><span class="line">    self._init_progress = progress</span><br><span class="line">    self._total_size = <span class="literal">None</span></span><br><span class="line">    self._done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    self._last_line = <span class="string">""</span></span><br><span class="line">    self._line_num = <span class="number">0</span></span><br><span class="line">    self._lines = []</span><br><span class="line">    self._buffer = <span class="literal">None</span></span><br><span class="line">    self._done = <span class="literal">False</span></span><br><span class="line">    self._done_and_last_line = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    self._bytes_read = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Stubs for testing.</span></span><br><span class="line">    self._sleep = time.sleep</span><br><span class="line">    self._rand = random.random</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">next</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> self._buffer <span class="keyword">or</span> len(self._lines) == (self._line_num + <span class="number">1</span>)) <span class="keyword">and</span> <span class="keyword">not</span> self._done_and_last_line:</span><br><span class="line">      <span class="keyword">if</span> self._lines:</span><br><span class="line">        self._last_line = self._lines[self._line_num]</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> self._done:</span><br><span class="line">        self._buffer, self._done = self.read(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        self._buffer = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">      self._lines = re.split(<span class="string">'\r|\n|\r\n'</span>, self._buffer)</span><br><span class="line">      self._line_num = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">      <span class="comment"># Handle special case where our block just happens to end on a new line</span></span><br><span class="line">      <span class="keyword">if</span> self._buffer[<span class="number">-1</span>:] == <span class="string">"\n"</span> <span class="keyword">or</span> self._buffer[<span class="number">-1</span>:] == <span class="string">"\r"</span>:</span><br><span class="line">        self._lines.append(<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self._buffer:</span><br><span class="line">      <span class="keyword">if</span> self._done <span class="keyword">and</span> <span class="keyword">not</span> self._last_line:</span><br><span class="line">        <span class="keyword">raise</span> StopIteration</span><br><span class="line"></span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        self._done_and_last_line = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> self._line_num == <span class="number">0</span> <span class="keyword">and</span> len(self._last_line) &gt; <span class="number">0</span>:</span><br><span class="line">      <span class="comment"># print 'fixing'</span></span><br><span class="line">      result = self._last_line + self._lines[self._line_num] + <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      result = self._lines[self._line_num] + <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># check csv header</span></span><br><span class="line">    <span class="keyword">if</span> self._bytes_read == <span class="number">0</span> <span class="keyword">and</span> self._init_progress == <span class="number">0</span>:</span><br><span class="line">      <span class="comment"># if not re.match('email', result.lower().replace('"', '')):</span></span><br><span class="line">      <span class="comment">#   raise ValueError('csv header must contain "email or EMAIL" property.')</span></span><br><span class="line">      <span class="comment">#</span></span><br><span class="line">      <span class="comment"># else:</span></span><br><span class="line">      result = result.lower()</span><br><span class="line"></span><br><span class="line">    self._bytes_read += len(result)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> self._done_and_last_line:</span><br><span class="line">      self._line_num += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      self._last_line = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self, num_retries=<span class="number">0</span>)</span>:</span></span><br><span class="line">    <span class="string">"""Get the next chunk of the download.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      num_retries: Integer, number of times to retry 500's with randomized</span></span><br><span class="line"><span class="string">            exponential backoff. If all retries fail, the raised HttpError</span></span><br><span class="line"><span class="string">            represents the last request. If zero (default), we attempt the</span></span><br><span class="line"><span class="string">            request only once.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">      (status, done): (MediaDownloadStatus, boolean)</span></span><br><span class="line"><span class="string">         The value of 'done' will be True when the media has been fully</span></span><br><span class="line"><span class="string">         downloaded.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Raises:</span></span><br><span class="line"><span class="string">      apiclient.errors.HttpError if the response was not a 2xx.</span></span><br><span class="line"><span class="string">      httplib2.HttpLib2Error if a transport error has occured.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">      headers = &#123;</span><br><span class="line">        <span class="string">'range'</span>: <span class="string">'bytes=%d-%d'</span> % (</span><br><span class="line">          self._progress, self._progress + self._chunksize)</span><br><span class="line">      &#125;</span><br><span class="line">      http = self._request.http</span><br><span class="line">      msg = <span class="string">'read bytes=&#123;:d&#125;-&#123;:d&#125;/&#123;&#125;'</span>.format(self._progress,</span><br><span class="line">                                             (self._progress + self._chunksize),</span><br><span class="line">                                             str(self._total_size) <span class="keyword">if</span> self._total_size <span class="keyword">else</span> <span class="string">'*'</span>)</span><br><span class="line">      logging.info(msg)</span><br><span class="line">      <span class="keyword">print</span> msg</span><br><span class="line"></span><br><span class="line">      <span class="keyword">for</span> retry_num <span class="keyword">in</span> xrange(num_retries + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> retry_num &gt; <span class="number">0</span>:</span><br><span class="line">          self._sleep(self._rand() * <span class="number">2</span> ** retry_num)</span><br><span class="line">          logging.warning(</span><br><span class="line">            <span class="string">'Retry #%d for media download: GET %s, following status: %d'</span></span><br><span class="line">            % (retry_num, self._uri, resp.status))</span><br><span class="line"></span><br><span class="line">        resp, content = http.request(self._uri, headers=headers)</span><br><span class="line">        <span class="keyword">if</span> resp.status &lt; <span class="number">500</span>:</span><br><span class="line">          <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> resp.status <span class="keyword">in</span> [<span class="number">200</span>, <span class="number">206</span>]:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'content-location'</span> <span class="keyword">in</span> resp <span class="keyword">and</span> resp[<span class="string">'content-location'</span>] != self._uri:</span><br><span class="line">          self._uri = resp[<span class="string">'content-location'</span>]</span><br><span class="line">        self._progress += len(content)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'content-range'</span> <span class="keyword">in</span> resp:</span><br><span class="line">          content_range = resp[<span class="string">'content-range'</span>]</span><br><span class="line">          length = content_range.rsplit(<span class="string">'/'</span>, <span class="number">1</span>)[<span class="number">1</span>]</span><br><span class="line">          self._total_size = int(length)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> self._progress == self._total_size:</span><br><span class="line">          self._done = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> content, self._done</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> HttpError(resp, content, uri=self._uri)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">      logging.warning(<span class="string">'gcs iterator error manual retry'</span>)</span><br><span class="line">      logging.error(e.message)</span><br><span class="line"></span><br><span class="line">      self._sleep(self._rand() * <span class="number">2</span> ** <span class="number">2</span>)</span><br><span class="line">      self.read()</span><br></pre></td></tr></table></figure>
<p>在 <code>GCSIterator.py</code> 中把 GCS JSON API 的 chunks 下載 csv 資料的程式碼植入 iterator 並解決斷行的問題。</p>
<h2 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get gcloud</span></span><br><span class="line">$ curl https://sdk.cloud.google.com | bash</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get App Engine component</span></span><br><span class="line">$ gcloud components update app</span><br><span class="line">$ gcloud components update gae-python</span><br><span class="line"></span><br><span class="line"><span class="comment"># Clone repo from github</span></span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/cage1016/GCSIterator</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install pip packages</span></span><br><span class="line">$ sudo pip install -r requirements.txt -t lib</span><br></pre></td></tr></table></figure>
<p>Replace your <code>bucket-name</code> and <code>object-name</code>. You may also modify <code>chunksize</code> at line 24 in <code>main.py</code> file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_authenticated_service</span><span class="params">()</span>:</span></span><br><span class="line">  credentials = GoogleCredentials.get_application_default()</span><br><span class="line">  http = credentials.authorize(httplib2.Http())</span><br><span class="line">  <span class="keyword">return</span> discovery_build(<span class="string">'storage'</span>, <span class="string">'v1'</span>, http=http)</span><br><span class="line"></span><br><span class="line">gcs_service = get_authenticated_service()</span><br><span class="line">bucket_name = <span class="string">'&lt;your-bucket-name&gt;'</span> <span class="comment"># waldo-gcp-file</span></span><br><span class="line">object_name = <span class="string">'&lt;your-object-name&gt;'</span> <span class="comment"># kaichu_1016_00000100.csv</span></span><br><span class="line"></span><br><span class="line">request = gcs_service.objects().get_media(bucket=bucket_name, object=object_name.encode(<span class="string">'utf8'</span>))</span><br><span class="line">iterator = GCSIterator(request, chunksize=<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">reader = csv.DictReader(iterator, skipinitialspace=<span class="literal">True</span>, delimiter=<span class="string">','</span>)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> reader:</span><br><span class="line">  <span class="keyword">print</span> row</span><br></pre></td></tr></table></figure>
<p>Execute <code>main.py</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sample output</span></span><br><span class="line">$ python main.py</span><br><span class="line"><span class="built_in">read</span> bytes=0-512/*</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000000@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000000'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000001@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000001'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000002@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000002'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000003@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000003'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000004@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000004'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000005@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000005'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000006@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000006'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000007@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000007'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000008@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000008'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000009@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000009'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000010@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000010'</span>&#125;</span><br><span class="line"><span class="built_in">read</span> bytes=513-1025/4411</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000011@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000011'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000012@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000012'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000013@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000013'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000014@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000014'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000015@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000015'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000016@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000016'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000017@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000017'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000018@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000018'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000019@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000019'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000020@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000020'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000021@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000021'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000022@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000022'</span>&#125;</span><br><span class="line"><span class="built_in">read</span> bytes=1026-1538/4411</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000023@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000023'</span>&#125;</span><br><span class="line">&#123;<span class="string">'email'</span>: <span class="string">'kaichu_1016+00000024@gmail.com'</span>, <span class="string">'name'</span>: <span class="string">'cage00000024'</span>&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol>
<li><a href="https://cloud.google.com/appengine/docs/python/" target="_blank" rel="noopener">GAE - Python</a></li>
<li><a href="https://docs.python.org/2/library/csv.html" target="_blank" rel="noopener">13.1. csv — CSV File Reading and Writing — Python 2.7.10 documentation</a></li>
<li><a href="https://cloud.google.com/appengine/articles/deadlineexceedederrors" target="_blank" rel="noopener">Dealing with DeadlineExceededErrors - App Engine — Google Cloud Platform</a></li>
<li><a href="https://github.com/google/google-api-python-client/blob/80da1eff23d7dc02d9f66f82754aa86b55f73be6/googleapiclient/http.py#L477" target="_blank" rel="noopener">google-api-python-client/http.py at 80da1eff23d7dc02d9f66f82754aa86b55f73be6 · google/google-api-python-client</a></li>
<li><a href="https://github.com/cage1016/GCSIterator" target="_blank" rel="noopener">cage1016/GCSIterator</a></li>
</ol>
</div></article></div></section><footer><div class="paginator"><a href="/2015/08/14/webpack-es6-demo/" class="prev">PREV</a><a href="/2015/07/27/gae-todomvc/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'kaichuio';
var disqus_identifier = '2015/07/28/gcsiterator/';
var disqus_title = 'GCSIterator (Python CSV iterator for Google Cloud Storage) via GAE';
var disqus_url = 'http://kaichu.io/2015/07/28/gcsiterator/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//kaichuio.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2020 <a href="http://kaichu.io">KAI CHU CHUNG</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-65308340-1",'auto');ga('send','pageview');</script></body></html>